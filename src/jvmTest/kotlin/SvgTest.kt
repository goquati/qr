import io.github.goquati.qr.QrCode
import io.github.goquati.qr.toSvg
import io.kotest.matchers.shouldBe
import org.intellij.lang.annotations.Language
import kotlin.io.path.Path
import kotlin.io.path.writeText
import kotlin.test.Test

@Language("svg")
private const val BASIC_SVG = """
<svg id="basicSvg" xmlns="http://www.w3.org/2000/svg" viewBox="-0.0 -0.0 21.0 21.0" width="50mm" height="50mm">
  <defs>
    <marker id="basicSvgPixel">
      <rect x="0.0" y="0.0" width="1.0" height="1.0" rx="0.0" fill="black" fill-opacity="1.0"/>
    </marker>
  </defs>
  <rect x="-0.0" y="-0.0" width="21.0" height="21.0" fill="none" fill-opacity="1.0"/>
  <polyline fill="none" marker-mid="url(#basicSvgPixel)"
    points="0,0 0,0 0,1 0,2 0,3 0,4 0,5 0,6 0,8 0,9 0,11 0,12 0,14 0,15 0,16 0,17 0,18 0,19 0,20 1,0 1,6 1,8 1,9 1,11 1,14 1,20 2,0 2,2 2,3 2,4 2,6 2,8 2,10 2,11 2,12 2,14 2,16 2,17 2,18 2,20 3,0 3,2 3,3 3,4 3,6 3,8 3,9 3,11 3,12 3,14 3,16 3,17 3,18 3,20 4,0 4,2 4,3 4,4 4,6 4,8 4,9 4,11 4,14 4,16 4,17 4,18 4,20 5,0 5,6 5,9 5,12 5,14 5,20 6,0 6,1 6,2 6,3 6,4 6,5 6,6 6,8 6,10 6,12 6,14 6,15 6,16 6,17 6,18 6,19 6,20 7,8 7,10 7,11 8,1 8,3 8,5 8,6 8,8 8,9 8,10 8,13 8,14 8,16 8,17 8,18 8,19 8,20 9,2 9,3 9,5 9,8 9,10 9,13 9,17 9,18 9,19 10,4 10,5 10,6 10,7 10,10 10,11 10,14 10,16 10,17 10,19 10,20 11,1 11,3 11,5 11,8 11,11 11,14 11,16 11,17 11,18 11,19 12,1 12,2 12,3 12,5 12,6 12,10 12,11 12,14 12,15 12,16 12,18 12,19 12,20 13,8 13,9 13,10 13,11 13,12 13,14 13,15 13,16 13,17 13,18 13,19 14,0 14,1 14,2 14,3 14,4 14,5 14,6 14,9 14,10 14,12 14,16 14,20 15,0 15,6 15,8 15,9 15,10 15,13 15,14 15,15 15,16 15,18 15,20 16,0 16,2 16,3 16,4 16,6 16,9 16,11 16,12 16,13 16,15 16,16 16,17 16,19 17,0 17,2 17,3 17,4 17,6 17,8 17,9 17,11 17,12 17,13 17,15 17,16 17,19 17,20 18,0 18,2 18,3 18,4 18,6 18,9 18,10 18,11 18,13 18,14 18,15 18,17 18,18 18,19 19,0 19,6 19,8 19,9 19,10 19,14 19,17 19,20 20,0 20,1 20,2 20,3 20,4 20,5 20,6 20,9 20,12 20,13 0,0"
  />
</svg>
"""


class SvgTest {

    @Test
    fun testBasicSvg() {
        val svg = QrCode.encodeText("https://quati.de", QrCode.Ecc.LOW).toSvg {
            id = "basicSvg"
            svgSize = "50mm"
            pixelStyle {
                id = "basicSvgPixel"
            }
        }
        svg.trim() shouldBe BASIC_SVG.trim()
    }

    @Test
    fun testFinderStyle() {
        val svg = QrCode.encodeText("https://quati.de", QrCode.Ecc.LOW).toSvg {
            id = "finderSvg"
            finderStyle {
                innerColor = "#00CE93"
                innerBorderRadius = 0.8
            }
            finderStyle {
                outerColor = "#00CE93"
                outerBorderRadius = 1.6
            }
        }

        Path("./build/finderStyle.svg").writeText(svg)
    }

    @Test
    fun testQuati() {
        val svg = QrCode.encodeText("https://quati.de", QrCode.Ecc.HIGH).toSvg {
            backgroundStyle {
                //fill = "white"
                borderSizePixel = 0.0
            }
            pixelStyle {
                size = 0.9
                borderRadius = 0.3
            }
            finderStyle {
                innerColor = "#00CE93"
                outerColor = "#00CE93"
                innerBorderRadius = 0.8
                outerBorderRadius = 1.6
            }
            innerSvg(border = 0.1, svg=
                """
                |<svg viewBox="0 0 447.99 396.88" xmlns="http://www.w3.org/2000/svg">
                |    <defs>
                |        <linearGradient id="lg" x2="1"
                |                        gradientTransform="matrix(-841.36 -996.95 -996.95 841.36 422.66 416.65)"
                |                        gradientUnits="userSpaceOnUse">
                |            <stop stop-color="#00ec6b" offset=".1091"/>
                |            <stop stop-color="#00a6bb" offset=".42107"/>
                |        </linearGradient>
                |    </defs>
                |    <path transform="matrix(1.3333 0 0 -1.3333 0 396.88)"
                |          d="m195.65 103.2c1.311-2.385 3.116-3.316 5.335-3.494 28.281-2.281 37.284-26.827 20.862-49.966-2.698-3.801-5.378-7.827-8.041-11.989-12.134-18.96-46.323-37.633-15.57-0.07 9.653 11.791-16.795 16.024-30.753 16.024s-40.406-4.233-30.753-16.024c30.753-37.563-3.437-18.89-15.57 0.07-2.663 4.162-5.343 8.188-8.042 11.989-16.421 23.139-7.418 47.685 20.863 49.966 2.219 0.178 4.024 1.109 5.335 3.494 5.146 9.361-7.406 64.835-14.969 63.594-7.785-1.276-4.929-21.024-48.564-18.041-0.052 5e-3 -0.098-0.018-0.15-0.024-27.462 3.673-49.93-10.787-49.93-33.655 0-23.251 30.595-46.777 49.981-60.866 7.542-5.481 17.953-15.662 24.324-22.468 8.366-8.936 18.55-20.609 24.87-24.093 12.124-6.682 18.616-7.628 28.908-7.646h0.612c3.715 6e-3 7.936 0.117 13.085 0.117 5.147 0 9.37-0.111 13.085-0.117h0.612c10.294 0.018 16.783 0.963 28.908 7.646 6.321 3.484 16.504 15.157 24.87 24.093 6.372 6.806 16.783 16.987 24.324 22.468 19.386 14.089 49.981 37.615 49.981 60.866 0 22.868-22.468 37.328-49.929 33.655-0.053 6e-3 -0.099 0.029-0.152 0.024-43.634-2.983-40.778 16.765-48.563 18.041-0.083 0.014-0.168 0.021-0.252 0.021-7.586 6e-3 -19.806-54.357-14.717-63.615"
                |          fill="url(#lg)"/>
                |    <path transform="matrix(1.3333 0 0 -1.3333 0 396.88)"
                |          d="m307.46 297.66c-14.287-5e-3 -31.563-8.453-45.441-27.302-2.894-3.938-1.849-7.648-0.083-9.632 2.36-2.647 6.463-3.292 9.551-1.526 3.122 1.784 4.948 3.41 7.472 5.67 1.468 1.309 3.276 2.93 5.893 5.072 11.283 9.227 21.467 9.785 25.681 5.553 4.003-4.022 7.275-12.958-3.149-25.602-5.67-6.867-12.941-10.678-11.373-22.253 2.542-18.759 2.238-20.678-3.311-22.126-3.614-0.139-5.353 2.207-9.408 5.102-9.193 6.55-23.081 16.447-51.62 18.172-13.647 0.825-24.219 5.064-31.288 9.006-8.386 4.677-19.295 20.462-21.796 21.834-2.365 1.296-4.39-0.258-4.827-2.311-2.104-9.856 10.774-30.027 14.174-33.325 16.956-16.446 43.547-15.137 59.738-22.205 22.968-10.027 49.313-29.73 57.665-43.513 1.48-2.436 4.056-3.868 6.863-3.868 0.275 0 0.557 0.012 0.838 0.041 3.182 0.323 5.83 2.394 6.903 5.406 1.08 3.011 1.233 12.919 1.115 39.322l-0.028 10.724c0 9.169 0.287 16.665 3.885 22.704 9.239 15.521 19.582 45.603-0.27 59.903-4.683 3.373-10.609 5.154-17.171 5.154z"
                |          fill="url(#lg)"/>
                |    <path transform="matrix(1.3333 0 0 -1.3333 0 396.88)"
                |          d="m28.524 297.66c-6.56-1e-3 -12.489-1.782-17.17-5.154-19.853-14.3-9.51-44.382-0.271-59.903 3.599-6.039 3.886-13.535 3.886-22.704l-0.029-10.724c-0.118-26.403 0.035-36.311 1.115-39.322 1.074-3.012 3.722-5.083 6.903-5.406 0.282-0.029 0.563-0.041 0.839-0.041 2.806 0 5.383 1.432 6.862 3.868 8.353 13.783 34.081 35.037 57.665 43.513 6.235 2.242 13.296 2.894 20.128 3.522 14.487 1.338 29.467 2.718 38.535 18.525 2.372 4.133 15.713 32.6 12.579 34.949-2.712 2.034-6.513-4.26-10-8.77-3.823-4.946-8.493-9.174-13.952-12.219-7.07-3.942-17.641-8.181-31.289-9.006-28.539-1.725-42.427-11.622-51.619-18.172-4.056-2.895-7.014-5.007-9.409-5.102-0.576 1.879 0.223 7.308 0.664 10.325 0.557 3.81 1.079 7.408 0.815 10.419-0.704 7.907-6.592 15.99-12.262 22.858-10.425 12.643-11.053 22.357-7.049 26.379 4.213 4.232 14.398 3.674 25.68-5.553 2.617-2.142 4.426-3.763 5.893-5.072 2.524-2.26 4.35-3.886 7.472-5.67 3.088-1.766 7.191-1.121 9.551 1.526 1.767 1.984 2.812 5.694-0.083 9.632-13.879 18.851-31.153 27.299-45.44 27.302z"
                |          fill="url(#lg)"/>
                |</svg>
                """.trimMargin()
            )
        }
        Path("./build/quati.svg").writeText(svg)
    }
}
